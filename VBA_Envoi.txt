Sub UpdateData()
    On Error GoTo ErrorHandler

    Dim olNamespace As Object
    Dim olInbox As Object
    Dim olSubfolder As Object
    Dim msg As Object
    Dim att As Object
    Dim strFilePath As String
    Dim strFileName As String
    Dim xlApp As Excel.Application
    Dim xlWorkbook As Excel.Workbook
    Dim xlWorksheet As Excel.Worksheet
    Dim i As Integer

    ' Spécifiez le chemin où vous souhaitez enregistrer les pièces jointes
    strFilePath = "C:\Users\BC002424\Desktop\Komla Martin CHOKKI\Collecte des EF 2023\Retour\"

    ' Créez une nouvelle instance d'Excel
    Set xlApp = New Excel.Application
    ' Ouvrez le classeur "Liste des EF"
    Set xlWorkbook = xlApp.Workbooks.Open("C:\Users\BC002424\Desktop\Komla Martin CHOKKI\Collecte des EF 2023\Liste des EF.xlsx")
    ' Sélectionnez la feuille "Liste"
    Set xlWorksheet = xlWorkbook.Sheets("Liste")

    ' Effacez les anciennes données (en commençant par la deuxième ligne car la première ligne contient les en-têtes)
    xlWorksheet.Range("A2:C" & xlWorksheet.Cells(xlWorksheet.Rows.Count, 1).End(-4162).Row).ClearContents

    ' Commencez à remplir les données à partir de la deuxième ligne
    i = 2

    ' Sélectionnez la boîte de réception
    Set olNamespace = CreateObject("Outlook.Application").GetNamespace("MAPI")
    Set olInbox = olNamespace.GetDefaultFolder(6) ' 6 = olFolderInbox

    ' Sélectionnez le sous-dossier "ETATS FINANCIERS"
    Set olSubfolder = olInbox.Folders("ETATS FINANCIERS")

    ' Parcourez tous les e-mails du sous-dossier
    For Each msg In olSubfolder.Items
        ' Parcourez toutes les pièces jointes de l'e-mail
        For Each att In msg.Attachments
            ' Vérifiez si la pièce jointe n'est pas une image
            If Right(att.FileName, 4) <> ".jpg" And Right(att.FileName, 5) <> ".jpeg" And Right(att.FileName, 4) <> ".png" And Right(att.FileName, 4) <> ".gif" Then
                ' Construisez le nom du fichier
                strFileName = strFilePath & att.FileName

                ' Enregistrez la pièce jointe sur le disque
                att.SaveAsFile strFileName

                ' Enregistrez le lien du fichier, l'adresse e-mail et l'objet dans le fichier Excel
                xlWorksheet.Cells(i, 1) = strFileName
                xlWorksheet.Cells(i, 2) = msg.SenderEmailAddress
                xlWorksheet.Cells(i, 3) = msg.Subject

                i = i + 1
            End If
        Next att
    Next msg

    ' Sauvegardez et fermez le classeur Excel
    xlWorkbook.Save
    xlWorkbook.Close

    MsgBox "La macro s'est exécutée avec succès.", vbInformation
    Exit Sub

ErrorHandler:
    MsgBox "Une erreur s'est produite : " & Err.Description, vbCritical

    Set olNamespace = Nothing
    Set olInbox = Nothing
    Set olSubfolder = Nothing
    Set msg = Nothing
    Set att = Nothing
    Set xlApp = Nothing
    Set xlWorkbook = Nothing
    Set xlWorksheet = Nothing
End Sub
